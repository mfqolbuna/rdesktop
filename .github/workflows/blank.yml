name: ğŸš€ SEVER AI STV PREMIUM

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '6h'
        type: choice
        options:
        - '6h'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-latest
    timeout-minutes: 360  # 6 jam
    
    steps:
      # BANNER CHÃ€O Má»ªNG
      - name: ğŸ¯ KHá»I Äá»˜NG Há»† THá»NG
        run: |
          Write-Host ""
          Write-Host ""
          Write-Host "ğŸ¤– AI STV PREMIUM RDP SERVER" -ForegroundColor Yellow
          Write-Host "âš¡ Powered by AI STV" -ForegroundColor Green
          Write-Host "ğŸ•’ Thá»i gian: SELAMANYA (siklus 6h + 10s)" -ForegroundColor Magenta
          Write-Host ""
          
          # Hiá»‡u á»©ng loading
          $frames = @('â£¾', 'â£½', 'â£»', 'â¢¿', 'â¡¿', 'â£Ÿ', 'â£¯', 'â£·')
          for($i=0; $i -lt 10; $i++) {
              Write-Host "`rğŸš€ Äang khá»Ÿi táº¡o há»‡ thá»‘ng... $($frames[$i % 8])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Milliseconds 100
          }
          Write-Host "`râœ… Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng!                    " -ForegroundColor Green

      # Cáº¤U HÃŒNH NÃ‚NG CAO
      - name: ğŸ”§ Cáº¤U HÃŒNH Há»† THá»NG
        run: |
          Write-Host ""
          Write-Host "ğŸ› ï¸  ÄANG Cáº¤U HÃŒNH Há»† THá»NG" -ForegroundColor Yellow
          
          $steps = @(
              @{Name="Báº­t Remote Desktop"; Script={ 
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
              }},
              @{Name="Táº¯t xÃ¡c thá»±c máº¡ng"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
              }},
              @{Name="Cáº¥u hÃ¬nh báº£o máº­t RDP"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
              }},
              @{Name="Má»Ÿ port 3389 firewall"; Script={
                  netsh advfirewall firewall add rule name="RDP-Premium" dir=in action=allow protocol=TCP localport=3389 profile=any
                  netsh advfirewall firewall add rule name="RDP-Premium-Out" dir=out action=allow protocol=TCP localport=3389 profile=any
              }},
              @{Name="Khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥"; Script={
                  Set-Service -Name TermService -StartupType Automatic -ErrorAction SilentlyContinue
                  Set-Service -Name UmRdpService -StartupType Automatic -ErrorAction SilentlyContinue
                  Start-Service -Name TermService -ErrorAction SilentlyContinue
                  Start-Service -Name UmRdpService -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $steps) {
              Write-Host "â”‚ ğŸ“‹ $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`râ”‚ âœ… $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`râ”‚ âš ï¸  $($step.Name) - ÄÃ£ bá» qua lá»—i nhá»" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 500
          }
          
          Write-Host "ğŸ¯ Cáº¥u hÃ¬nh hoÃ n táº¥t!" -ForegroundColor Green

      # Táº O USER PREMIUM
      - name: ğŸ‘¤ Táº O TÃ€I KHOáº¢N PREMIUM
        run: |
          Write-Host ""
          Write-Host "ğŸ‘¤ ÄANG Táº O TÃ€I KHOáº¢N PREMIUM" -ForegroundColor Yellow
          
          # HÃ m táº¡o password ngáº¯n (8 kÃ½ tá»±)
          function New-PremiumPassword {
              param()
              $upper = 'ABCDEFGHJKLMNPQRSTUVWXYZ'
              $lower = 'abcdefghijkmnpqrstuvwxyz'
              $numbers = '23456789'
              $all = $upper + $lower + $numbers

              $pw = ''
              $pw += $upper[(Get-Random -Minimum 0 -Maximum $upper.Length)]
              $pw += $lower[(Get-Random -Minimum 0 -Maximum $lower.Length)]
              $pw += $numbers[(Get-Random -Minimum 0 -Maximum $numbers.Length)]

              for ($i = 1; $i -le 5; $i++) {
                  $pw += $all[(Get-Random -Minimum 0 -Maximum $all.Length)]
              }

              return -join ($pw.ToCharArray() | Sort-Object { Get-Random })
          }

          if ($env:CUSTOM_RDP_PASS) {
              $matKhau = $env:CUSTOM_RDP_PASS
              Write-Host "â”‚ â„¹ï¸  DÃ¹ng máº­t kháº©u tÃ¹y chá»‰nh tá»« env" -ForegroundColor Blue
          } else {
              $matKhau = New-PremiumPassword
          }

          $securePass = ConvertTo-SecureString $matKhau -AsPlainText -Force
          
          # XÃ³a user cÅ© náº¿u tá»“n táº¡i
          try {
              Remove-LocalUser -Name "AISTV-PREMIUM" -ErrorAction SilentlyContinue
              Write-Host "â”‚ âœ… ÄÃ£ xÃ³a user cÅ©" -ForegroundColor Green
          } catch {
              Write-Host "â”‚ â„¹ï¸  KhÃ´ng cÃ³ user cÅ© Ä‘á»ƒ xÃ³a" -ForegroundColor Blue
          }
          
          # Táº¡o user má»›i
          try {
              New-LocalUser -Name "AISTV-PREMIUM" -Password $securePass -AccountNeverExpires -Description "AI STV Premium Account"
              Write-Host "â”‚ âœ… ÄÃ£ táº¡o user má»›i" -ForegroundColor Green
              
              try {
                  Set-LocalUser -Name "AISTV-PREMIUM" -PasswordNeverExpires $true -ErrorAction SilentlyContinue
              } catch {}

              # ThÃªm vÃ o cÃ¡c nhÃ³m
              Add-LocalGroupMember -Group "Administrators" -Member "AISTV-PREMIUM" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Remote Desktop Users" -Member "AISTV-PREMIUM" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Users" -Member "AISTV-PREMIUM" -ErrorAction SilentlyContinue
              
              Enable-LocalUser -Name "AISTV-PREMIUM"
              Write-Host "â”‚ âœ… ÄÃ£ cáº¥p quyá»n Administrator & RDP" -ForegroundColor Green
              
          } catch {
              Write-Host "â”‚ âŒ Lá»—i táº¡o user: $($_.Exception.Message)" -ForegroundColor Red
              exit 1
          }
          
          echo "RDP_USER=AISTV-PREMIUM" >> $env:GITHUB_ENV
          echo "RDP_PASS=$matKhau" >> $env:GITHUB_ENV
          echo "$matKhau" > $env:TEMP\rdp_password.txt
          
          Write-Host "âœ… TÃ i khoáº£n: AISTV-PREMIUM Ä‘Ã£ sáºµn sÃ ng" -ForegroundColor Green

      # KIá»‚M TRA QUYá»€N ÄÄ‚NG NHáº¬P
      - name: ğŸ” KIá»‚M TRA QUYá»€N Há»† THá»NG
        run: |
          Write-Host ""
          Write-Host "ğŸ” KIá»‚M TRA QUYá»€N ÄÄ‚NG NHáº¬P" -ForegroundColor Yellow
          
          $user = Get-LocalUser -Name "AISTV-PREMIUM" -ErrorAction SilentlyContinue
          if ($user) {
              Write-Host "â”‚ âœ… User AISTV-PREMIUM tá»“n táº¡i" -ForegroundColor Green
              Write-Host "â”‚ ğŸ“Š Tráº¡ng thÃ¡i: $($user.Enabled)" -ForegroundColor White
          } else {
              Write-Host "â”‚ âŒ User khÃ´ng tá»“n táº¡i" -ForegroundColor Red
              exit 1
          }
          
          $isAdmin = (Get-LocalGroupMember -Group "Administrators" | Where-Object {$_.Name -like "*AISTV-PREMIUM"}).Count -gt 0
          if ($isAdmin) {
              Write-Host "â”‚ âœ… CÃ³ quyá»n Administrator" -ForegroundColor Green
          } else {
              Write-Host "â”‚ âŒ KhÃ´ng cÃ³ quyá»n Administrator" -ForegroundColor Red
          }
          
          $isRDPUser = (Get-LocalGroupMember -Group "Remote Desktop Users" | Where-Object {$_.Name -like "*AISTV-PREMIUM"}).Count -gt 0
          if ($isRDPUser) {
              Write-Host "â”‚ âœ… CÃ³ quyá»n Remote Desktop" -ForegroundColor Green
          } else {
              Write-Host "â”‚ âŒ KhÃ´ng cÃ³ quyá»n Remote Desktop" -ForegroundColor Red
          }
          
          $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
          if ($termService.Status -eq 'Running') {
              Write-Host "â”‚ âœ… Dá»‹ch vá»¥ TermService Ä‘ang cháº¡y" -ForegroundColor Green
          } else {
              Write-Host "â”‚ âŒ Dá»‹ch vá»¥ TermService khÃ´ng cháº¡y" -ForegroundColor Red
          }
          
          Write-Host "ğŸ¯ Kiá»ƒm tra hoÃ n táº¥t!" -ForegroundColor Green

      # TAILSCALE PREMIUM
      - name: ğŸŒ THIáº¾T Láº¬P Máº NG PREMIUM
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          Write-Host ""
          Write-Host "ğŸŒ ÄANG THIáº¾T Láº¬P Káº¾T Ná»I Máº NG" -ForegroundColor Yellow
          
          try {
              $msiPath = "$env:TEMP\tailscale-premium.msi"
              Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi" -OutFile $msiPath
              Start-Process msiexec.exe -ArgumentList "/i", "`"$msiPath`"", "/quiet", "/norestart" -Wait
              Remove-Item $msiPath -Force -ErrorAction SilentlyContinue
              Write-Host "â”‚ âœ… CÃ i Ä‘áº·t Tailscale thÃ nh cÃ´ng" -ForegroundColor Green
          } catch {
              Write-Host "â”‚ âŒ Lá»—i cÃ i Ä‘áº·t Tailscale" -ForegroundColor Red
          }
          
          Start-Sleep -Seconds 10
          
          try {
              & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$env:TAILSCALE_AUTH_KEY --hostname=ai-stv-premium-$env:GITHUB_RUN_ID --accept-routes --accept-dns --reset
              Write-Host "â”‚ âœ… Káº¿t ná»‘i Tailscale thÃ nh cÃ´ng" -ForegroundColor Green
          } catch {
              Write-Host "â”‚ âŒ Lá»—i káº¿t ná»‘i Tailscale" -ForegroundColor Red
          }
          
          Write-Host "ğŸ”„ Äang láº¥y Ä‘á»‹a chá»‰ IP..." -NoNewline -ForegroundColor Blue
          $ip = $null
          for($i=0; $i -lt 20; $i++) {
              try {
                  $ip = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4 2>&1
                  if ($ip -and $ip -match '^\d+\.\d+\.\d+\.\d+$') {
                      echo "TAILSCALE_IP=$ip" >> $env:GITHUB_ENV
                      Write-Host "`râœ… Äá»‹a chá»‰ IP: $ip" -ForegroundColor Green
                      break
                  }
              } catch {}
              Write-Host "`rğŸ”„ Äang láº¥y Ä‘á»‹a chá»‰ IP... $(@('.', '..', '...')[$i % 3])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Seconds 3
          }
          
          if (-not $ip -or $ip -notmatch '^\d+\.\d+\.\d+\.\d+$') {
              Write-Host "`râš ï¸  KhÃ´ng thá»ƒ láº¥y IP, sá»­ dá»¥ng localhost" -ForegroundColor Yellow
              echo "TAILSCALE_IP=localhost" >> $env:GITHUB_ENV
          }

      # HIá»‚N THá»Š GIAO DIá»†N Äáº¸P
      - name: ğŸ‰ THÃ”NG TIN Káº¾T Ná»I
        run: |
          $matKhau = Get-Content $env:TEMP\rdp_password.txt -ErrorAction SilentlyContinue
          if (-not $matKhau) {
              $matKhau = "KhÃ´ng thá»ƒ Ä‘á»c máº­t kháº©u"
          }
          
          # Siklus 6 jam
          $totalMinutes = 360
          $displayTime = "6 giá» (siklus berulang)"
          
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" -ForegroundColor Cyan
          Write-Host "â”‚    ğŸ‰ Káº¾T Ná»I THÃ€NH CÃ”NG! (SELAMANYA)     â”‚" -ForegroundColor Cyan
          Write-Host "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤" -ForegroundColor Cyan
          Write-Host "â”‚ ğŸŒ  Äá»‹a chá»‰: $env:TAILSCALE_IP" -ForegroundColor White
          Write-Host "â”‚ ğŸ‘¤  TÃ i khoáº£n: AISTV-PREMIUM" -ForegroundColor White
          Write-Host "â”‚ ğŸ”  Máº­t kháº©u: $matKhau" -ForegroundColor White
          Write-Host "â”‚ â°  Mode: SELAMANYA (6h + 10s cycle)" -ForegroundColor Magenta
          Write-Host "â”‚ ğŸ”„  Siklus: 6 jam kerja + 10 detik jeda" -ForegroundColor White
          Write-Host "â”‚ ğŸ•  Báº¯t Ä‘áº§u: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "â”‚ ğŸ•  Reset: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "â”‚ ğŸ“  Port: 3389" -ForegroundColor White
          Write-Host "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤" -ForegroundColor Cyan
          Write-Host "â”‚ ğŸ’¡  HÆ°á»›ng dáº«n:                                    â”‚" -ForegroundColor Cyan
          Write-Host "â”‚   1. Má»Ÿ Remote Desktop Connection                 â”‚" -ForegroundColor Yellow
          Write-Host "â”‚   2. Nháº­p: $env:TAILSCALE_IP                      â”‚" -ForegroundColor Yellow
          Write-Host "â”‚   3. User: AISTV-PREMIUM | Password: trÃªn          â”‚" -ForegroundColor Yellow
          Write-Host "â”‚   4. Koneksi akan auto-reset setiap 6 jam         â”‚" -ForegroundColor Yellow
          Write-Host "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" -ForegroundColor Cyan
          
          echo "TOTAL_MINUTES=$totalMinutes" >> $env:GITHUB_ENV

      # DUY TRÃŒ PHIÃŠN á»”N Äá»ŠNH DENGAN SIKLUS
      - name: â³ DUY TRÃŒ PHIÃŠN LÃ€M VIá»†C (SELAMANYA)
        run: |
          $matKhau = Get-Content $env:TEMP\rdp_password.txt -ErrorAction SilentlyContinue
          $totalMinutes = $env:TOTAL_MINUTES
          
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "ğŸ”„ Báº®T Äáº¦U PHIÃŠN LÃ€M VIá»†C SELAMANYA..." -ForegroundColor Yellow
          Write-Host "ğŸ’ PhiÃªn: AI STV PREMIUM (UNLIMITED)" -ForegroundColor Magenta
          Write-Host "ğŸ”— Káº¿t ná»‘i: $env:TAILSCALE_IP" -ForegroundColor Cyan
          Write-Host "ğŸ”„ Mode: 6 jam kerja + 10 detik jeda" -ForegroundColor Green
          Write-Host "ğŸ• Báº¯t Ä‘áº§u: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor Green
          Write-Host ""
          
          # Counter untuk siklus
          $cycleCount = 0
          
          # Monitor script
          $monitorScript = {
              $lastLogTime = Get-Date
              while ($true) {
                  $currentTime = Get-Date
                  
                  if (($currentTime - $lastLogTime).TotalMinutes -ge 2) {
                      $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
                      $rdpConnections = Get-NetTCPConnection -LocalPort 3389 -ErrorAction SilentlyContinue | Where-Object {$_.State -eq 'Established'}
                      
                      Write-Host "[$($currentTime.ToString('HH:mm:ss'))] ğŸ“Š Status - RDP: $($termService.Status), Connections: $($rdpConnections.Count)" -ForegroundColor Blue
                      $lastLogTime = $currentTime
                  }
                  
                  $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
                  if ($termService.Status -ne 'Running') {
                      Write-Host "[$($currentTime.ToString('HH:mm:ss'))] ğŸ”„ Restarting TermService..." -ForegroundColor Yellow
                      Start-Service -Name TermService -ErrorAction SilentlyContinue
                  }
                  
                  Start-Sleep -Seconds 30
              }
          }
          
          # Jalankan monitor di background
          Start-Job -ScriptBlock $monitorScript -Name "SystemMonitor"
          
          # Main loop untuk siklus 6 jam
          while ($true) {
              $cycleCount++
              $cycleStartTime = Get-Date
              $cycleEndTime = $cycleStartTime.AddMinutes(360) # 6 jam
              
              Write-Host ""
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Magenta
              Write-Host "ğŸš€ SIKLUS KE-$cycleCount DIMULAI" -ForegroundColor Green
              Write-Host "â° Waktu: $($cycleStartTime.ToString('HH:mm:ss'))" -ForegroundColor Cyan
              Write-Host "â³ Durasi: 6 jam (360 menit)" -ForegroundColor Cyan
              Write-Host "ğŸ• Selesai: $($cycleEndTime.ToString('HH:mm:ss'))" -ForegroundColor Cyan
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Magenta
              Write-Host ""
              
              # Timer untuk siklus saat ini
              $frames = @('â ‹', 'â ™', 'â ¹', 'â ¸', 'â ¼', 'â ´', 'â ¦', 'â §', 'â ‡', 'â ')
              $colors = @('Red', 'Yellow', 'Green', 'Cyan', 'Blue', 'Magenta')
              $siklusStart = Get-Date
              
              do {
                  $thoiGianHienTai = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
                  $thoiGianConLai = $cycleEndTime - $thoiGianHienTai
                  
                  if ($thoiGianConLai.TotalSeconds -gt 0) {
                      $jamSiklus = [math]::Floor(($cycleEndTime - $thoiGianHienTai).TotalHours)
                      $menitSiklus = [math]::Floor(($cycleEndTime - $thoiGianHienTai).TotalMinutes % 60)
                      $detikSiklus = [math]::Floor(($cycleEndTime - $thoiGianHienTai).TotalSeconds % 60)
                      
                      $frame = $frames[([int]((Get-Date) - $siklusStart).TotalSeconds) % $frames.Length]
                      $color = $colors[([int]((Get-Date) - $siklusStart).TotalMinutes) % $colors.Length]
                      
                      Write-Host "`r$frame [$($thoiGianHienTai.ToString('HH:mm:ss'))] Siklus $cycleCount - Waktu: $jamSiklus:$menitSiklus:$detikSiklus | Total: $cycleCount cycles" -NoNewline -ForegroundColor $color
                      
                      # Check service setiap 30 detik
                      if ([math]::Floor($detikSiklus % 30) -eq 0) {
                          $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
                          if ($termService.Status -ne 'Running') {
                              Write-Host "`n[$($thoiGianHienTai.ToString('HH:mm:ss'))] âš ï¸  Restarting service..." -ForegroundColor Yellow
                              Start-Service -Name TermService -Force -ErrorAction SilentlyContinue
                          }
                      }
                      
                      Start-Sleep -Seconds 5
                  }
                  
              } while ($thoiGianConLai.TotalSeconds -gt 0)
              
              Write-Host ""
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Yellow
              Write-Host "ğŸ”„ SIKLUS KE-$cycleCount SELESAI" -ForegroundColor Yellow
              Write-Host "â° Waktu: $(Get-Date -Format 'HH:mm:ss')" -ForegroundColor Yellow
              Write-Host "â¸ï¸  Jeda 10 detik sebelum siklus berikutnya..." -ForegroundColor Yellow
              Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Yellow
              
              # Jeda 10 detik antara siklus
              for ($i = 10; $i -gt 0; $i--) {
                  Write-Host "`râ¸ï¸  Jeda: $i detik..." -NoNewline -ForegroundColor Magenta
                  Start-Sleep -Seconds 1
              }
              Write-Host ""
          }
          
          # Cleanup (tidak akan pernah sampai sini)
          Get-Job -Name "SystemMonitor" -ErrorAction SilentlyContinue | Stop-Job -PassThru | Remove-Job -Force

      # Dá»ŒN Dáº¸P CHUYÃŠN NGHIá»†P
      - name: ğŸ§¹ Dá»ŒN Dáº¸P Há»† THá»NG
        if: always()
        run: |
          Write-Host ""
          Write-Host "ğŸ§¹ ÄANG Dá»ŒN Dáº¸P Há»† THá»NG..." -ForegroundColor Yellow
          
          $cleanupSteps = @(
              @{Name="XÃ³a file password"; Script={
                  Remove-Item "$env:TEMP\rdp_password.txt" -ErrorAction SilentlyContinue
              }},
              @{Name="VÃ´ hiá»‡u hÃ³a user"; Script={
                  Disable-LocalUser -Name "AISTV-PREMIUM" -ErrorAction SilentlyContinue
              }},
              @{Name="ÄÃ³ng káº¿t ná»‘i máº¡ng"; Script={
                  & "$env:ProgramFiles\Tailscale\tailscale.exe" down --accept-risk=all -ErrorAction SilentlyContinue
                  Start-Sleep -Seconds 5
              }},
              @{Name="XÃ³a rule firewall"; Script={
                  netsh advfirewall firewall delete rule name="RDP-Premium" dir=in -ErrorAction SilentlyContinue
                  netsh advfirewall firewall delete rule name="RDP-Premium-Out" dir=out -ErrorAction SilentlyContinue
                  Remove-NetFirewallRule -DisplayName "RDP-Premium" -ErrorAction SilentlyContinue
                  Remove-NetFirewallRule -DisplayName "RDP-Premium-Out" -ErrorAction SilentlyContinue
              }},
              @{Name="KhÃ´i phá»¥c cÃ i Ä‘áº·t RDP"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 1 -Force -ErrorAction SilentlyContinue
                  Stop-Service -Name TermService -Force -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $cleanupSteps) {
              Write-Host "â”‚ ğŸ—‘ï¸  $($step.Name)..." -NoNewline -ForegroundColor Gray
              try {
                  & $step.Script
                  Write-Host "`râ”‚ âœ… $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`râ”‚ âš ï¸  $($step.Name) - ÄÃ£ xá»­ lÃ½ an toÃ n" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 300
          }
          
          Get-Job | Stop-Job -PassThru | Remove-Job -Force -ErrorAction SilentlyContinue
          
          Write-Host ""
          Write-Host "ğŸ‰ Dá»n dáº¹p hoÃ n táº¥t! Háº¹n gáº·p láº¡i! ğŸ‘‹" -ForegroundColor Green
